---
layout: ../../layouts/Layout.astro
---

<Layout title="Admin Dashboard">
  <section class="max-w-4xl mx-auto py-12">
    <h2 class="text-3xl font-bold mb-6">Admin Dashboard</h2>
    <div class="card">
      <div id="stats-root">Loading stats...</div>
    </div>
  </section>
  <script>
    async function loadStats() {
      const root = document.getElementById('stats-root');
      try {
        const res = await fetch('/api/admin/reports', { credentials: 'same-origin' });
        if (!res.ok) {
          root.innerText = 'Failed to load stats';
          return;
        }
        const json = await res.json();
        if (!json.ok) {
          root.innerText = 'Error: ' + (json.error || 'unknown');
          return;
        }
        const reports = json.reports || [];
        const total = reports.length;
        const open = reports.filter(r => r.status === 'open').length;
        const investigating = reports.filter(r => r.status === 'investigating').length;
        const closed = reports.filter(r => r.status === 'closed').length;
        root.innerHTML = `
          <div class="grid grid-cols-4 gap-4">
            <div class="p-4 bg-white rounded shadow">Total<br/><strong>${total}</strong></div>
            <div class="p-4 bg-white rounded shadow">Open<br/><strong>${open}</strong></div>
            <div class="p-4 bg-white rounded shadow">Investigating<br/><strong>${investigating}</strong></div>
            <div class="p-4 bg-white rounded shadow">Closed<br/><strong>${closed}</strong></div>
          </div>
        `;
      } catch (err) {
        root.innerText = 'Error loading admin stats';
      }
    }
    loadStats();
  </script>
</Layout>
